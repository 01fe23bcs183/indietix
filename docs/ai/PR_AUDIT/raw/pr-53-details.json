{"author":{"is_bot":true,"login":"app/devin-ai-integration"},"body":"## Context\n\nThis PR implements the core backend infrastructure for customer-initiated cancellations, policy-driven refunds, and FIFO waitlist functionality for sold-out events. This enables customers to cancel bookings with transparent refund calculations and allows customers to join a waitlist when events are sold out.\n\n**Session**: [Devin Run](https://app.devin.ai/sessions/31a4726f55c6436486fcc274edeee59e) - Requested by Jeevan H (@01fe23bcs183)\n\n## Plan\n\nThe implementation adds three new Prisma models (`Refund`, `WaitlistEntry`, `WaitlistOffer`), extends payment providers with refund capabilities, implements policy-driven refund calculations, and creates FIFO-based waitlist offer management with automatic expiry. All tests use `FakePaymentProvider` while production uses Razorpay's Refunds API.\n\n## Files Touched\n\n### Core Business Logic\n- **`packages/db/prisma/schema.prisma`** - Added `Refund`, `WaitlistEntry`, `WaitlistOffer` models; added `cancelledAt` to `Booking`\n- **`packages/utils/src/refund.ts`** - Refund calculation engine with configurable policies (default: ‚Çπ50 cancellation fee, 24-hour deadline)\n- **`packages/api/src/lib/waitlist.ts`** - FIFO waitlist offer creation and expiry logic\n- **`packages/api/src/routers/booking.ts`** - Booking cancellation procedures with policy validation\n- **`packages/api/src/routers/waitlist.ts`** - Waitlist join/claim/status tRPC procedures\n\n### Payment Integration\n- **`packages/payments/src/fake.ts`** - `createRefund()` for testing (always succeeds)\n- **`packages/payments/src/razorpay.ts`** - `createRefund()` integration with Razorpay Refunds API\n- **`packages/payments/src/types.ts`** - Added `RefundResult` type\n\n### Frontend\n- **`apps/web/src/app/offers/[offerId]/page.tsx`** - Waitlist offer claim page with 30-minute countdown timer\n- **`apps/web/src/app/api/cron/waitlist/route.ts`** - Endpoint for expiring waitlist offers\n\n### Infrastructure\n- **`.github/workflows/cron-waitlist.yml`** - Cron job (every 5 minutes) to expire unclaimed offers\n- **`docs/refunds.md`** - Refund policy documentation with examples\n- **`docs/waitlist.md`** - FIFO waitlist flow documentation\n\n### TypeScript Fixes (Unrelated to Feature)\n- Fixed implicit `any` types in transaction callbacks and map functions across organizer pages and webhook handler to make build pass\n\n## Tests\n\n- [x] Unit tests added (11 tests for refund calculations in `packages/utils/src/__tests__/refund.spec.ts`)\n- [ ] E2E tests for cancellation flow (not implemented)\n- [ ] E2E tests for waitlist flow (not implemented)\n- [x] All unit tests passing locally\n- [ ] Playwright tests have pre-existing failures (14 failed due to missing test data seeding)\n\n## Definition of Done\n\n### ‚úÖ Completed\n- [x] Prisma schema extended with new models\n- [x] Refund calculation logic with policy support\n- [x] Payment provider refund methods (Fake + Razorpay)\n- [x] Waitlist FIFO logic with expiry\n- [x] Waitlist offer claim page with countdown\n- [x] Cron job for offer expiry\n- [x] Documentation (refunds.md, waitlist.md)\n- [x] Unit tests for refund calculations\n- [x] Build passes locally\n- [x] All unit tests pass\n\n### ‚ö†Ô∏è Incomplete (Marked as Pending)\n- [ ] **Customer cancellation UI** in `/bookings/[id]` page (requirement: show refund breakdown modal)\n- [ ] **Organizer refund queue UI** (requirement: approve/reject/list refunds)\n- [ ] **Razorpay webhook extension** for refund events (requirement: handle `razorpay.refund.*` events)\n- [ ] **E2E tests** for cancellation and waitlist flows (requirement specified)\n\n### üîç Critical Review Areas\n\n1. **Database Migration Missing**: Prisma schema changes require running `pnpm db:migrate` - migration file not included in PR\n2. **Razorpay Refund API**: Integration is written but untested against real API (only FakeProvider tested)\n3. **Idempotency**: Code includes guards but no tests specifically validate re-running won't double-refund\n4. **Seat Accounting**: Verify that `bookedSeats` is correctly decremented when bookings are cancelled\n5. **Email Notifications**: Waitlist offers currently only log emails, don't actually send via Resend\n6. **Refund Calculation Edge Cases**: Review math in `computeRefund()` for correctness across all price points and quantities\n7. **Waitlist Race Conditions**: Verify FIFO logic handles concurrent offer creation safely\n8. **Hardcoded Configuration**: 30-minute offer expiry is hardcoded, not configurable\n\n### Security & Performance\n- [x] No credentials exposed\n- [x] CRON_TOKEN authentication for cron endpoints\n- [x] Proper error handling in refund calculations\n- [ ] Race condition testing needed for concurrent waitlist operations\n\n### Notes for Reviewer\n- Frontend UIs for customer cancellation and organizer refund management are **not implemented** in this PR\n- Webhook handler for Razorpay refund events is **not extended** (only TypeScript fix applied)\n- Playwright test failures are pre-existing (missing test data seeding)\n- TypeScript fixes in organizer app files are **unrelated** but necessary for build to pass","comments":[{"id":"IC_kwDOQMMC-M7PNpsJ","author":{"login":"devin-ai-integration"},"authorAssociation":"CONTRIBUTOR","body":"<details>\n<summary>Original prompt from Jeevan</summary>\n\n```\nYou are implementing IndieTix cancellations, refunds, and waitlist. All CI/tests must pass without network (use FakePaymentProvider); production uses Razorpay Refunds API.\n\n## Objectives\n1) Customer-initiated cancellation (policy-aware)\n   - Allow cancel if Event.allowCancellation = true and now <= event.cancellationDeadlineHours before event.startTime.\n   - Compute refund per platform policy (configurable) and per-event override.\n   - Create Refund record and attempt refund (Fake in tests; Razorpay in prod).\n   - Update Booking.status (CANCELLED) and PaymentStatus (REFUNDED) idempotently when money returned.\n   - Free seats and trigger waitlist offers.\n\n2) Organizer refund queue (admin/organizer)\n   - Organizer view: list refund requests (Pending/Approved/Rejected/Processed).\n   - Organizer can approve/reject (if policy requires manual approval).\n   - Admin override to force refund.\n\n3) Waitlist\n   - If Event is SOLD_OUT or no seats available: customers can join waitlist (email + phone).\n   - When seats are freed (via cancel, expiry), auto-create offer(s) FIFO:\n     - Offer has `expiresAt` (e.g., 30 minutes), quantity=1..N.\n     - Customer receives email (/ SMS placeholder) with unique link to claim.\n     - Claim creates a PENDING Booking (hold) and proceeds to checkout.\n     - On expiry without claim, offer auto-cancels and moves to next waitlisted user(s).\n\n4) Idempotency & safety\n   - All transitions are idempotent (re-running handlers shouldn‚Äôt double refund or double free/increment seats).\n   - Track external refund events in PaymentEvent table (extend to \"razorpay.refund.*\", {PAYMENT_EVENT_TABLE_NAME}).\n\n5) Tests\n   - Unit: refund amount calculation across edge cases; deadline logic; idempotent refund application; waitlist FIFO and offer expiry.\n   - Playwright (web):\n     - Cancel before deadline shows correct ‚ÄúYou‚Äôll receive ‚ÇπX‚Äù and marks booking CANCELLED (using fake provider).\n     - Sold-out event ‚Üí join waitlist ‚Üí on seat release, see ‚ÄúOffer available‚Äù ... (6981 chars truncated...)\n```\n</details>","createdAt":"2025-11-01T15:28:56Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/01fe23bcs183/indietix/pull/53#issuecomment-3476462345","viewerDidAuthor":true},{"id":"IC_kwDOQMMC-M7PNpsT","author":{"login":"devin-ai-integration"},"authorAssociation":"CONTRIBUTOR","body":"### ü§ñ Devin AI Engineer\n\nI'll be helping with this pull request! Here's what you should know:\n\n‚úÖ I will automatically:\n- Address comments on this PR. Add '(aside)' to your comment to have me ignore it.\n- Look at CI failures and help fix them\n\nNote: I can only respond to comments from users who have write access to this repository.\n\n‚öôÔ∏è Control Options:\n- [ ] Disable automatic comment and CI monitoring\n","createdAt":"2025-11-01T15:28:57Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/01fe23bcs183/indietix/pull/53#issuecomment-3476462355","viewerDidAuthor":true},{"id":"IC_kwDOQMMC-M7PNxWr","author":{"login":"qodo-merge-pro"},"authorAssociation":"NONE","body":"## PR Compliance Guide üîç\n\n\n<!-- https://github.com/01fe23bcs183/indietix/commit/b9765b19b4cef2aa52a38be33d11adb569f84947 -->\nBelow is a summary of compliance checks for this PR:<br>\n<table><tbody><tr><td colspan='2'><strong>Security Compliance</strong></td></tr>\n<tr><td rowspan=4>‚ö™</td>\n<td><details><summary><strong>Weak cron auth\n</strong></summary><br>\n\n<b>Description:</b> Cron endpoint relies solely on a static bearer token (<code>CRON_TOKEN</code>) without rate limiting or <br>IP allowlisting, risking token leakage leading to unauthorized trigger of expiry <br>operations.<br> <strong><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-01b92cc3209c79878d248066346c9ce70713b2c4dac9bd5c7ab1cd5ab979b1d6R5-R17'>route.ts [5-17]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```typescript\nconst authHeader = request.headers.get(\"authorization\");\nconst expectedToken = process.env.CRON_TOKEN;\n\nif (!expectedToken) {\n  return NextResponse.json(\n    { error: \"CRON_TOKEN not configured\" },\n    { status: 500 }\n  );\n}\n\nif (authHeader !== `Bearer ${expectedToken}`) {\n  return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n}\n```\n\n</details></details></td></tr>\n<tr><td><details><summary><strong>Duplicate refund risk\n</strong></summary><br>\n\n<b>Description:</b> Refund processing path calls external provider and updates multiple records without <br>explicit idempotency keys, risking duplicate refunds if mutation is retried or invoked <br>concurrently.<br> <strong><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-0f6ed9bfd91263ae12fa0ce824dd2684f079af7bc0c5691f28fc657b6aa0caeeR297-R353'>booking.ts [297-353]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```typescript\nconst { computeRefund, canCancelBooking } = await import(\n  \"@indietix/utils\"\n);\n\nconst now = new Date();\nconst canCancel = canCancelBooking({\n  now,\n  eventStart: booking.event.date,\n  deadlineHours: booking.event.cancellationDeadlineHours,\n  allowCancellation: booking.event.allowCancellation,\n});\n\nif (!canCancel.canCancel) {\n  throw new TRPCError({\n    code: \"BAD_REQUEST\",\n    message: canCancel.reason || \"Cancellation not allowed\",\n  });\n}\n\nconst refundCalc = computeRefund({\n  baseTicketPrice: booking.ticketPrice,\n\n\n ... (clipped 36 lines)\n```\n\n</details></details></td></tr>\n<tr><td><details><summary><strong>Race in offer issue\n</strong></summary><br>\n\n<b>Description:</b> Waitlist offer issuance iterates entries and opens a transaction per entry without locking <br>or uniqueness guards, enabling race conditions to issue multiple concurrent offers for the <br>same entry when multiple seats free simultaneously.<br> <strong><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-526e8c829689aadbf186ba9ed72f50d441b046843ac4bd645b0d7bf3a73d4b3cR28-R48'>waitlist.ts [28-48]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```typescript\nfor (const entry of activeEntries) {\n  await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    await tx.waitlistEntry.update({\n      where: { id: entry.id },\n      data: {\n        status: \"INVITED\",\n        invitedAt: new Date(),\n      },\n    });\n\n    await tx.waitlistOffer.create({\n      data: {\n        eventId,\n        entryId: entry.id,\n        quantity: 1,\n        expiresAt,\n        status: \"PENDING\",\n      },\n    });\n  });\n}\n```\n\n</details></details></td></tr>\n<tr><td><details><summary><strong>Weak webhook validation</strong></summary><br>\n\n<b>Description:</b> Webhook handling uses <code>event</code> string directly and logs payload but does not validate event <br>type whitelist or verify payload structure against provider schemas, increasing risk of <br>processing unexpected events if signature verification gaps exist elsewhere in the file.<br> <strong><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-ca51153573008f85dc2add4c804006da6881aaee945884fa3c5d24dedb6b90f2R72-R86'>route.ts [72-86]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```typescript\n    provider: \"razorpay\",\n    eventId: event,\n    bookingId: booking.id,\n    payload: payload,\n  },\n});\n\nif (event === \"payment.captured\") {\n  await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n    const currentBooking = await tx.booking.findUnique({\n      where: { id: booking.id },\n    });\n\n    if (!currentBooking) {\n      throw new Error(\"Booking not found\");\n```\n\n</details></details></td></tr>\n<tr><td colspan='2'><strong>Ticket Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary>üé´ <strong>No ticket provided </summary></strong>\n\n    \n- [ ] Create ticket/issue <!-- /create_ticket --create_ticket=true -->\n    \n</details></td></tr>\n<tr><td colspan='2'><strong>Codebase Duplication Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary><strong>Codebase context is not defined </strong></summary>\n\n\nFollow the <a href='https://qodo-merge-docs.qodo.ai/core-abilities/rag_context_enrichment/'>guide</a> to enable codebase context checks.\n\n</details></td></tr>\n<tr><td colspan='2'><strong>Custom Compliance</strong></td></tr>\n<tr><td rowspan=1>üü¢</td><td>\n<details><summary><strong>Generic: Meaningful Naming and Self-Documenting Code</strong></summary><br>\n\n**Objective:** Ensure all identifiers clearly express their purpose and intent, making code <br>self-documenting<br>\n\n**Status:** Passed<br>\n</details></td></tr>\n<tr><td rowspan=1>üî¥</td>\n<td><details>\n<summary><strong>Generic: Secure Error Handling</strong></summary><br>\n\n**Objective:** To prevent the leakage of sensitive system information through error messages while <br>providing sufficient detail for internal debugging.<br>\n\n**Status:** <br><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-01b92cc3209c79878d248066346c9ce70713b2c4dac9bd5c7ab1cd5ab979b1d6R29-R34'><strong>Sensitive error leakage</strong></a>: The endpoint returns error.message to clients on failure which can leak internal details; <br>user-facing responses should be generic while detailed info is kept in internal logs.<br>\n<details open><summary>Referred Code</summary>\n\n```typescript\nreturn NextResponse.json(\n  {\n    error: \"Failed to expire waitlist offers\",\n    message: error instanceof Error ? error.message : \"Unknown error\",\n  },\n  { status: 500 }\n```\n\n</details></details></td></tr>\n<tr><td rowspan=4>‚ö™</td>\n<td><details>\n<summary><strong>Generic: Comprehensive Audit Trails</strong></summary><br>\n\n**Objective:** To create a detailed and reliable record of critical system actions for security analysis <br>and compliance.<br>\n\n**Status:** <br><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-c7834f02aa81e79c0befcbc8bb3f895577d7fe774f45fb716cacdf767d705493R1-R245'><strong>Missing audit logs</strong></a>: New critical actions (joining waitlist, claiming offers) lack explicit audit/event logging <br>including user identification and action outcomes.<br>\n<details open><summary>Referred Code</summary>\n\n```typescript\nimport { z } from \"zod\";\nimport { router, publicProcedure } from \"../trpc\";\nimport { prisma, Prisma } from \"@indietix/db\";\nimport { TRPCError } from \"@trpc/server\";\n\nexport const waitlistRouter = router({\n  join: publicProcedure\n    .input(\n      z.object({\n        eventId: z.string(),\n        email: z.string().email(),\n        phone: z.string().optional(),\n        userId: z.string().optional(),\n      })\n    )\n    .mutation(async ({ input }) => {\n      const event = await prisma.event.findUnique({\n        where: { id: input.eventId },\n      });\n\n      if (!event) {\n\n\n ... (clipped 224 lines)\n```\n\n</details></details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Robust Error Handling and Edge Case Management</strong></summary><br>\n\n**Objective:** Ensure comprehensive error handling that provides meaningful context and graceful <br>degradation<br>\n\n**Status:** <br><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-01b92cc3209c79878d248066346c9ce70713b2c4dac9bd5c7ab1cd5ab979b1d6R27-R36'><strong>Error detail exposure</strong></a>: API returns internal error messages directly in JSON (including error.message) which may <br>expose provider or system details and lacks structured internal logging beyond <br>console.error.<br>\n<details open><summary>Referred Code</summary>\n\n```typescript\n} catch (error) {\n  console.error(\"Error expiring waitlist offers:\", error);\n  return NextResponse.json(\n    {\n      error: \"Failed to expire waitlist offers\",\n      message: error instanceof Error ? error.message : \"Unknown error\",\n    },\n    { status: 500 }\n  );\n}\n```\n\n</details></details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Secure Logging Practices</strong></summary><br>\n\n**Objective:** To ensure logs are useful for debugging and auditing without exposing sensitive <br>information like PII, PHI, or cardholder data.<br>\n\n**Status:** <br><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-af690b60f9456da3f7a727c2c6dc3fa85b18a4df4d2b34da8dc3b7e27c3182cfR25-R26'><strong>Unstructured logging</strong></a>: Console logging of operational data is unstructured and may risk incidental sensitive data <br>exposure; structured logging without sensitive fields is recommended.<br>\n<details open><summary>Referred Code</summary>\n\n```typescript\nconsole.log(`Found ${expiredBookings.length} expired bookings to clean up`);\n\n```\n\n</details></details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Security-First Input Validation and Data Handling</strong></summary><br>\n\n**Objective:** Ensure all data inputs are validated, sanitized, and handled securely to prevent <br>vulnerabilities<br>\n\n**Status:** <br><a href='https://github.com/01fe23bcs183/indietix/pull/53/files#diff-c7834f02aa81e79c0befcbc8bb3f895577d7fe774f45fb716cacdf767d705493R118-R200'><strong>Authz missing</strong></a>: Critical mutations like waitlist.claim and join rely on email/offerId without explicit <br>authentication/authorization checks in this diff, which may allow unauthorized actions if <br>not enforced elsewhere.<br>\n<details open><summary>Referred Code</summary>\n\n```typescript\nclaim: publicProcedure\n  .input(\n    z.object({\n      offerId: z.string(),\n    })\n  )\n  .mutation(async ({ input }) => {\n    const offer = await prisma.waitlistOffer.findUnique({\n      where: { id: input.offerId },\n      include: {\n        entry: {\n          include: {\n            event: true,\n          },\n        },\n      },\n    });\n\n    if (!offer) {\n      throw new TRPCError({\n        code: \"NOT_FOUND\",\n\n\n ... (clipped 62 lines)\n```\n\n</details></details></td></tr>\n\n<tr><td align=\"center\" colspan=\"2\">\n\n<!-- placeholder --> <!-- /compliance --update_compliance=true -->\n\n</td></tr></tbody></table>\n<details><summary>Compliance status legend</summary>\nüü¢ - Fully Compliant<br>\nüü° - Partial Compliant<br>\nüî¥ - Not Compliant<br>\n‚ö™ - Requires Further Human Verification<br>\nüè∑Ô∏è - Compliance label<br>\n</details>\n","createdAt":"2025-11-01T16:10:24Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/01fe23bcs183/indietix/pull/53#issuecomment-3476493739","viewerDidAuthor":false}],"commits":[{"authoredDate":"2025-11-01T15:27:42Z","authors":[{"email":"158243242+devin-ai-integration[bot]@users.noreply.github.com","id":"BOT_kgDOCW6Zqg","login":"devin-ai-integration[bot]","name":"Devin AI"},{"email":"01fe23bcs183@kletech.ac.in","id":"U_kgDODboTVQ","login":"01fe23bcs183","name":"Jeevan H"}],"committedDate":"2025-11-01T15:27:42Z","messageBody":"‚Ä¶en refunds\n\n- Add Refund, WaitlistEntry, WaitlistOffer models to Prisma schema\n- Implement refund calculation helper with configurable policies\n- Extend FakePaymentProvider and Razorpay with createRefund functionality\n- Add booking.cancel tRPC procedures with policy validation\n- Add waitlist tRPC procedures for join/claim/status\n- Implement FIFO waitlist offer system with 30-minute expiry\n- Add waitlist offer claim page at /offers/[offerId]\n- Create cron workflow for waitlist offer expiry\n- Add comprehensive unit tests for refund calculations (11 tests)\n- Create docs/refunds.md and docs/waitlist.md documentation\n- Fix TypeScript errors in existing code (transaction callbacks, map functions)\n- Export waitlist functions from API package for cron routes\n\nAll changes use FakePaymentProvider for tests and Razorpay for production.\nRefunds are policy-driven with configurable cancellation fees and deadlines.\nWaitlist offers expire after 30 minutes and move to next user in FIFO order.\n\nCo-Authored-By: Jeevan H <01fe23bcs183@kletech.ac.in>","messageHeadline":"feat: Implement cancellations, refunds, and waitlist with policy-driv‚Ä¶","oid":"2267516b64eb6f81d91f57cfe29b9160d1604e9f"},{"authoredDate":"2025-11-01T15:31:52Z","authors":[{"email":"158243242+devin-ai-integration[bot]@users.noreply.github.com","id":"BOT_kgDOCW6Zqg","login":"devin-ai-integration[bot]","name":"Devin AI"},{"email":"01fe23bcs183@kletech.ac.in","id":"U_kgDODboTVQ","login":"01fe23bcs183","name":"Jeevan H"}],"committedDate":"2025-11-01T15:31:52Z","messageBody":"Co-Authored-By: Jeevan H <01fe23bcs183@kletech.ac.in>","messageHeadline":"fix: Apply Prettier formatting and fix ESLint errors","oid":"34281dd4ff646424e18b93c1642daafae5f84c2c"},{"authoredDate":"2025-11-01T15:37:15Z","authors":[{"email":"158243242+devin-ai-integration[bot]@users.noreply.github.com","id":"BOT_kgDOCW6Zqg","login":"devin-ai-integration[bot]","name":"Devin AI"},{"email":"01fe23bcs183@kletech.ac.in","id":"U_kgDODboTVQ","login":"01fe23bcs183","name":"Jeevan H"}],"committedDate":"2025-11-01T15:37:15Z","messageBody":"‚Ä¶ion callbacks\n\nCo-Authored-By: Jeevan H <01fe23bcs183@kletech.ac.in>","messageHeadline":"fix: Use Prisma.TransactionClient type from @indietix/db for transact‚Ä¶","oid":"b9765b19b4cef2aa52a38be33d11adb569f84947"}],"files":[{"path":".github/workflows/cron-waitlist.yml","additions":18,"deletions":0},{"path":"apps/organizer/src/app/(dashboard)/events/[id]/attendees/page.tsx","additions":1,"deletions":1},{"path":"apps/organizer/src/app/(dashboard)/events/page.tsx","additions":1,"deletions":1},{"path":"apps/web/src/app/api/cron/holds/route.ts","additions":1,"deletions":1},{"path":"apps/web/src/app/api/cron/waitlist/route.ts","additions":37,"deletions":0},{"path":"apps/web/src/app/api/webhooks/razorpay/route.ts","additions":2,"deletions":2},{"path":"apps/web/src/app/offers/[offerId]/page.tsx","additions":296,"deletions":0},{"path":"docs/refunds.md","additions":270,"deletions":0},{"path":"docs/waitlist.md","additions":348,"deletions":0},{"path":"packages/api/src/index.ts","additions":3,"deletions":0},{"path":"packages/api/src/lib/waitlist.ts","additions":91,"deletions":0},{"path":"packages/api/src/routers/booking.ts","additions":271,"deletions":3},{"path":"packages/api/src/routers/organizer/attendees.ts","additions":2,"deletions":2},{"path":"packages/api/src/routers/waitlist.ts","additions":245,"deletions":0},{"path":"packages/db/prisma/schema.prisma","additions":118,"deletions":24},{"path":"packages/payments/src/fake.ts","additions":16,"deletions":1},{"path":"packages/payments/src/razorpay.ts","additions":25,"deletions":2},{"path":"packages/payments/src/types.ts","additions":12,"deletions":0},{"path":"packages/utils/src/__tests__/refund.spec.ts","additions":202,"deletions":0},{"path":"packages/utils/src/index.ts","additions":6,"deletions":0},{"path":"packages/utils/src/refund.ts","additions":168,"deletions":0}],"labels":[{"id":"LA_kwDOQMMC-M8AAAACOhapTg","name":"Review effort 4/5","description":"","color":"d1bcf9"}],"mergeCommit":{"oid":"748123c5cf1b841c5442f60bcb0a8b9b352acd39"},"mergedAt":"2025-11-01T16:09:47Z","number":53,"reviewDecision":"","reviews":[],"title":"[refunds] Cancellations + Refunds + Waitlist (policy-driven, idempotent, CI-safe)"}
